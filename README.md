# Описание проекта

Данное десктопное приложение представляет собой программу «АТС» для управления междугородними тарифами.  
Приложение построено на Java (Swing). Представлена реализация как Java-проектом, так и исполняемым файлом (.exe / .msi, собирается через jpackage / launch4j) — для запуска на ПК без установленной JRE.

В 5-й лабораторной работе проект доработан: данные о тарифах переносятся в базу данных **SQLite**, а все операции (добавление / изменение / удаление / импорт / экспорт) работают через БД.

# Функциональные возможности

## Управление тарифами

- Добавление нового тарифа (диалог «Добавить»).
- Редактирование существующего тарифа (диалог «Изменить»).
- Удаление тарифа.
- Отображение всех тарифов в таблице (сортировка по клику по заголовку).
- Защита от дубликатов (точно такой же город/тип/цена/скидка не добавляется).

Минимум два окна:

- Главное окно `MainFrame` с таблицей и меню.
- Диалог `TariffFormDialog` с перегруженным конструктором:
  - режим «Добавить»;
  - режим «Изменить» (подставляет значения выбранного тарифа и меняет надписи/кнопку).

## Импорт / экспорт

- Импорт тарифов из CSV (UTF-8; разделитель `;`, первая строка — `city;type;price;discount`).
- Экспорт тарифов в CSV (UTF-8 с BOM — корректно открывается в Excel).
- Импорт/экспорт выполняются через стандартный диалог выбора файла (`JFileChooser`, аналог OpenFileDialog).

В ЛР-5:

- импорт **загружает данные в БД** (добавлением, без очистки);
- при импорте дубликаты пропускаются (по бизнес-правилам и по UNIQUE-ограничению в таблице).

## Расчёты

- Средняя итоговая цена по всем тарифам.
- Общая сумма итоговых цен.
- Массовое изменение всех цен на заданный процент (с проверкой диапазона).

## Проверки и устойчивость

- Валидация города/цены/скидки на уровне сервиса (`TariffManager`).
- Предметные ошибки через `TariffException` (показываются пользователю в диалогах).
- Поле «Скидка» блокируется для обычного тарифа (`REGULAR`).
- В таблице числа сортируются как числа (за счёт `getColumnClass()`).
- Дополнительные проверки логики, чтобы пользователь не мог «сломать» приложение (проверка диапазонов, индексов, пустых списков и т.д.).

# Работа с базой данных (SQLite)

В 5-й лабораторной данные о тарифах хранятся не в списке в памяти, а в базе данных **SQLite**:

- Файл базы данных: `atc.db` (создаётся в рабочей папке приложения при первом запуске).
- Таблица тарифов:

  ```sql
  CREATE TABLE IF NOT EXISTS tariffs (
      city     TEXT NOT NULL,
      type     TEXT NOT NULL CHECK (type IN ('REGULAR', 'PRIVILEGED')),
      price    REAL NOT NULL,
      discount REAL NOT NULL,
      UNIQUE (city, type, price, discount)
  );

  ## Доступ к данным

Доступ к данным реализован через слой репозиториев (`atc.data`):

- `TariffRepository` — интерфейс хранилища;
- `InMemoryTariffRepository` — in-memory реализация (для тестов);
- `SqliteTariffRepository` — основная реализация на SQLite через JDBC.

`TariffManager` работает не с «сырым» списком, а через `TariffRepository`:

- добавление / изменение / удаление тарифов сразу отражаются в БД;
- методы агрегирования (средняя / общая цена, массовое изменение) рассчитываются по данным из БД.

## Структура проекта

```text
src/
├── atc/
│   ├── model   — Tariff, TariffType
│   ├── service — TariffManager, TariffException
│   ├── io      — CsvIO
│   ├── data    — TariffRepository,
│   │             InMemoryTariffRepository,
│   │             SqliteTariffRepository
└── ui          — App, MainFrame, TariffFormDialog, TariffTableModel

## Требования для запуска через .jar

- JDK 17+ (JavaFX не требуется — используется Swing).
- Драйвер SQLite JDBC (`sqlite-jdbc`) должен быть доступен в classpath  
  (подключён как внешняя библиотека или упакован в исполняемый JAR).

**Сборка исполняемого JAR в IntelliJ IDEA:**

1. `Build → Build Artifacts…`
2. `JAR → From modules with dependencies…`
3. Указать `Main class`: `atc.App`
4. Собрать артефакт и запускать через `java -jar ...`  
   или использовать как входной файл для `jpackage` / launch4j при сборке `.exe` / `.msi`.

## Вывод

В ходе выполнения 5-й лабораторной работы консольное приложение было перенесено в формат десктопного GUI-приложения на Java Swing и дополнено поддержкой базы данных SQLite.  
Реализованы все требуемые операции над тарифами (добавление, изменение, удаление, сортировка, импорт/экспорт, расчёты), данные хранятся в таблице БД, а изменения, выполняемые пользователем через интерфейс, сразу отражаются в базе.  
Таким образом, выполнены требования задания по работе с формами, валидацией ввода, файловыми операциями и интеграцией приложения с СУБД.

